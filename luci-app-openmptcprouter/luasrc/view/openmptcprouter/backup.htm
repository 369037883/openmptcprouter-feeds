<%+header%>

<% if stderr and #stderr > 0 then %><pre class="error"><%=pcdata(stderr)%></pre><% end %>
<form class="inline" method="post" action="<%=url('admin/system/openmptcprouter/backupgr')%>">
    <div class="cbi-map">
	<h2 name="content"><%:Backup on server%></h2>
	<fieldset class="cbi-section" id="networks">
		<%
		    uci:foreach("openmptcprouter","server", function(s)
			servername = s[".name"]
		%>
		<h3><%=servername%></h3>
		<%
		    if luci.model.uci.cursor():get("openmptcprouter",servername,"lastbackup") ~= "" then
		%>
			<div class="cbi-section-node">
				<%:Last available backup on server:%> <%=os.date('%d-%b-%Y', luci.model.uci.cursor():get("openmptcprouter",servername,"lastbackup"))%>
			</div>
			<input type="hidden" name="token" value="<%=token%>" />
			<input type="submit" class="cbi-button cbi-button-action important" name="restore" value="<%:Restore backup%>"/>
			<input type="submit" class="cbi-button cbi-button-action important" name="save" value="<%:Send backup%>"/>
		<% else %>
			<div class="cbi-section-node">
				<%:No available backup on server.%>
			</div>
			<input type="hidden" name="token" value="<%=token%>" />
			<input type="submit" class="cbi-button cbi-button-action important" name="save" value="<%:Send backup%>"/>
		<% end %>
	    <%
		end)
	    %>
	</fieldset>
    </div>
</form>
<%+footer%>
